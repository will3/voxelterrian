#version 330 core

in vec3 fragmentColor;
in vec3 fragmentNormal;
in vec4 shadowCoord;

uniform vec3 light_dir;
uniform vec3 ambient_light;
uniform sampler2DShadow shadowMap;

out vec3 color;

void main()
{
	float cosTheta = dot(fragmentNormal, light_dir);

	vec3 ambient = ambient_light;

	float visibility = texture( shadowMap, vec3(shadowCoord.xy, (shadowCoord.z)/shadowCoord.w) );

	color = fragmentColor * cosTheta * visibility + ambient;
}